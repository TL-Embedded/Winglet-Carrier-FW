
#include "USB_Composite.h"

#ifdef USB_CLASS_COMPOSITE

#include "USB_CDCX.h"

/*
 * PRIVATE DEFINITIONS
 */

/*
 * PRIVATE TYPES
 */

/*
 * PRIVATE PROTOTYPES
 */

/*
 * PRIVATE VARIABLES
 */

__ALIGNED(4) const uint8_t cUSB_Composite_ConfigDescriptor[USB_COMPOSITE_CONFIG_DESC_SIZE] =
{
	USB_DESCR_BLOCK_CONFIGURATION(USB_COMPOSITE_CONFIG_DESC_SIZE, USB_COMPOSITE_INTERFACES, 0x01),
	// USB_CDC[0]
	USB_DESC_BLOCK_INTERFACE_ASSOCIATION(0, 2, 2, 2, 0),
	USB_DESCR_BLOCK_INTERFACE(0,0x01,0x02,0x02,0x01),
	0x05,0x24,0x00,0x10,
	0x01,0x05,0x24,0x01,
	0x00,0x01,0x04,0x24,
	0x02,0x02,0x05,0x24,
	0x06,0x00,0x01,
	USB_DESCR_BLOCK_ENDPOINT(((1+1)|0x80),0x03,8,0x10),
	USB_DESCR_BLOCK_INTERFACE(0+1,0x02,0x0A,0x00,0x00),
	USB_DESCR_BLOCK_ENDPOINT((1+0),0x02,USB_PACKET_SIZE,0x00),
	USB_DESCR_BLOCK_ENDPOINT(((1+0)|0x80),0x02,USB_PACKET_SIZE,0x00),
	// USB_CDC[1]
	USB_DESC_BLOCK_INTERFACE_ASSOCIATION(2, 2, 2, 2, 0),
	USB_DESCR_BLOCK_INTERFACE(2,0x01,0x02,0x02,0x01),
	0x05,0x24,0x00,0x10,
	0x01,0x05,0x24,0x01,
	0x00,0x03,0x04,0x24,
	0x02,0x02,0x05,0x24,
	0x06,0x02,0x03,
	USB_DESCR_BLOCK_ENDPOINT(((3+1)|0x80),0x03,8,0x10),
	USB_DESCR_BLOCK_INTERFACE(2+1,0x02,0x0A,0x00,0x00),
	USB_DESCR_BLOCK_ENDPOINT((3+0),0x02,USB_PACKET_SIZE,0x00),
	USB_DESCR_BLOCK_ENDPOINT(((3+0)|0x80),0x02,USB_PACKET_SIZE,0x00),
	// USB_CDC[2]
	USB_DESC_BLOCK_INTERFACE_ASSOCIATION(4, 2, 2, 2, 0),
	USB_DESCR_BLOCK_INTERFACE(4,0x01,0x02,0x02,0x01),
	0x05,0x24,0x00,0x10,
	0x01,0x05,0x24,0x01,
	0x00,0x05,0x04,0x24,
	0x02,0x02,0x05,0x24,
	0x06,0x04,0x05,
	USB_DESCR_BLOCK_ENDPOINT(((5+1)|0x80),0x03,8,0x10),
	USB_DESCR_BLOCK_INTERFACE(4+1,0x02,0x0A,0x00,0x00),
	USB_DESCR_BLOCK_ENDPOINT((5+0),0x02,USB_PACKET_SIZE,0x00),
	USB_DESCR_BLOCK_ENDPOINT(((5+0)|0x80),0x02,USB_PACKET_SIZE,0x00),
};

/*
 * PUBLIC FUNCTIONS
 */

void USB_Composite_Init(uint8_t config)
{
	USB_CDCX_Init(config);
}

void USB_Composite_Deinit(void)
{
	USB_CDCX_Deinit();
}

void USB_Composite_Setup(USB_SetupRequest_t * req)
{
	uint8_t interface = LOBYTE(req->wIndex);
	
    if (interface < 2)
    {
        USB_CDCX_Setup(0, req);
    }
    else if (interface < 4)
    {
        USB_CDCX_Setup(1, req);
    }
    else if (interface < 6)
    {
        USB_CDCX_Setup(2, req);
    }
}

/*
 * PRIVATE FUNCTIONS
 */

#endif //USB_CLASS_COMPOSITE

